CREATE OR ALTER VIEW V_NOTA_SERVICO(
    CFIL,
    DESCRICAO_SERVICO,
    CID,
    EST,
    BISS,
    VISS,
    CSSL,
    VIRF,
    VINSS,
    VCOF,
    VPIS,
    VDES,
    VNOT,
    VALOR_SERVICO,
    VALOR_ISS,
    VALOR_LIQUIDO,
    VALOR_FRETE,
    OBS,
    SER,
    DEMI,
    NNOT,
    COD_CADCLI,
    AISS,
    AIRF,
    ACSLL,
    ACOF,
    APIS,
    AINSS,
    COD,
    NATUREZA_OPERACAO,
    ISS_RETIDO,
    CIDADE_TOMADOR,
    UF_TOMADOR,
    MES_COMPETENCIA,
    ANO_COMPETENCIA,
    COD_SERVICO,
    NOME_SERVICO,
    CODIGOTRIBUTACAO,
    SUBITEM)
AS
select A.SERIE, cast(A.DESCRICAO_SERVICO as varchar(2000)), B.CLIEA60CIDRES, B.CLIEA2UFRES, A.BASE_CALCULO_ISS as BISS,
       A.ALIQUOTA_ISS as VISS, A.VALOR_CSSL as CSSL, A.VALOR_IRPJ as VIRF, A.VALOR_INSS as VINSS,
       A.VALOR_COFINS as VCOF, A.VALOR_PIS as VPIS, A.VALOR_DEDUCAO as VDES, A.VALOR_TOTAL as VNOT,
       A.VALOR_SERVICO as VALOR_SERVICO, A.valor_iss as VALOR_ISS, A.VALOR_LIQUIDO as VALOR_LIQUIDO,
       A.VALOR_FRETE as VALOR_FRETE, A.OBS, A.SERIE as SER, cast(A.DATA_EMISSAO as date) as DEMI, A.NUMERO_NOTA as NNOT,
       B.CLIEA13ID as COD_CADCLI, A.ALIQUOTA_ISS as ISSQN_ALIQUOTA, 0 IRRF_ALIQUOTA, A.VALOR_CSSL, A.VALOR_COFINS,
       A.VALOR_PIS, A.VALOR_INSS, A.ID, A.LOCAL_TRIBUTACAO as NATUREZA_OPERACAO, A.ISS_RETIDO, A.MUNICIPIO_PRESTACAO,
       A.UF_PRESTACAO, extract(month from A.DATA_EMISSAO) MES_COMPETENCIA,
       extract(year from A.DATA_EMISSAO) as ANO_COMPETENCIA, C.NOME_SERVICO, cast(C.DESCRICAO_SERVICO as varchar(2000)),
       D.CODIGO_TRIBUTACAO, D.SUBITEM
from NOTASERVICO A
inner join CLIENTE B on B.CLIEA13ID = A.CLIEA13ID
inner join SERVICO C on C.ID_SERVICO = A.ID_SERVICO
inner join TRIBUTACAO_NFSE D on D.ID = A.ID_TRIBUTACAO
;